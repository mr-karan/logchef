import{c as Ue,at as xe,R as v,d as Me,ae as Ae,g as ue,W as ne,ai as Ve,a as b,F as V,m,i as t,t as _,w as l,u as a,h as Oe,j as s,_ as y,B as j,k as c,aK as Ne,l as De,af as Ie,o as d}from"./index-DhD1Jy6j.js";import{_ as W,a as G,b as J}from"./CardHeader.vue_vue_type_script_setup_true_lang-B98r7nf9.js";import{_ as Q,a as X}from"./CardTitle.vue_vue_type_script_setup_true_lang-C7I42q6I.js";import{_ as O,a as Pe}from"./Label.vue_vue_type_script_setup_true_lang-CYXJfKeA.js";import{_ as Le}from"./Textarea.vue_vue_type_script_setup_true_lang-D0jxCyCO.js";import{_ as je,a as Be,b as Y,c as Z}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-C1YIFBM7.js";import{i as S,T as o,g as k}from"./types-ByjhqKv5.js";import{t as g}from"./teams-B0mpmRSw.js";import{_ as ie,a as oe,b as B,c as E,d as de,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-ag95AMYa.js";import{_ as me,e as fe,a as ve,b as ce,c as pe,d as _e}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DfBq9sy2.js";import{_ as ye}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-ChvGnXMc.js";import{_ as h,a as ee,b as ae,c as te,d as F}from"./SelectValue.vue_vue_type_script_setup_true_lang-aDyRn7dA.js";import{u as Fe}from"./users-DXED7m9B.js";import{u as qe}from"./sources-BtojJ080.js";import{L as N,f as Se,a as ze}from"./format-D5zbNZR6.js";import{P as Re}from"./plus-J0EuN1f1.js";import{T as be}from"./trash-2-CmwYiK2P.js";import{f as He}from"./format-HUUZeily.js";import"./monaco-editor-2qzqsP3x.js";import"./base-AlOswPYA.js";/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=Ue("UserPlusIcon",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),We=xe("users",()=>{const D=v([]),R=v(!1),n=v(null);async function f(){if(!R.value)try{R.value=!0,n.value=null;const p=await Fe.listUsers();if(S(p)){n.value=p.data.error;return}D.value=p.data}catch(p){n.value="Failed to load users",console.error("Error loading users:",p)}finally{R.value=!1}}function $(p){return D.value.filter(i=>!p.includes(i.id)&&!p.includes(Number(i.id)))}return{users:D,isLoading:R,error:n,loadUsers:f,getUsersNotInTeam:$}}),Ge={class:"space-y-6"},Je={key:0,class:"text-center py-4"},Qe={key:1,class:"text-center py-4"},Xe={class:"text-2xl font-bold tracking-tight"},Ye={class:"flex items-center justify-between"},Ze={class:"space-y-4 py-4"},he={class:"space-y-2"},ea={class:"space-y-2"},aa={class:"flex flex-col"},ta={class:"text-sm text-muted-foreground"},la={class:"flex items-center justify-between"},ra={class:"space-y-4 py-4"},sa={class:"space-y-2"},ua={class:"space-y-4"},na={class:"grid gap-2"},ia={class:"grid gap-2"},oa={class:"flex justify-end"},Ma=Me({__name:"TeamSettings",setup(D){const R=Oe(),{toast:n}=Ae(),f=v(null),$=v([]),p=v(!0),i=v(!1),T=v(""),I=v(""),C=v(!1),P=v("member"),U=v(""),x=We(),q=qe(),z=v([]),M=v(!1),A=v(""),ge=ue(()=>{var e;const r=((e=$.value)==null?void 0:e.map(u=>String(u.user_id)))||[];return x.getUsersNotInTeam(r)}),Ee=ue(()=>{var e;const r=((e=z.value)==null?void 0:e.map(u=>u.id))||[];return q.getSourcesNotInTeam(r)});ne(C,async r=>{r&&!x.users.length&&await x.loadUsers()}),ne(M,async r=>{r&&!q.sources.length&&await q.loadSources()});const le=r=>x.users.find(e=>e.id===String(r)),re=async()=>{try{p.value=!0;const r=await g.getTeam(Number(R.params.id));if(S(r)){n({title:"Error",description:r.data.error,variant:"destructive",duration:o.ERROR});return}f.value=r.data,T.value=f.value.name,I.value=f.value.description||"",await H()}catch(r){console.error("Error loading team:",r),n({title:"Error",description:k(r),variant:"destructive",duration:o.ERROR})}finally{p.value=!1}},H=async()=>{try{const r=await g.listTeamMembers(Number(R.params.id));if(S(r)){n({title:"Error",description:r.data.error,variant:"destructive",duration:o.ERROR});return}$.value=r.data}catch(r){console.error("Error loading team members:",r),n({title:"Error",description:k(r),variant:"destructive",duration:o.ERROR})}},K=async()=>{try{const r=await g.listTeamSources(Number(R.params.id));if(S(r)){n({title:"Error",description:r.data.error,variant:"destructive",duration:o.ERROR});return}z.value=r.data}catch(r){console.error("Error loading team sources:",r),n({title:"Error",description:k(r),variant:"destructive",duration:o.ERROR})}},we=async()=>{if(!(i.value||!f.value)){if(!T.value){n({title:"Error",description:"Please enter a team name",variant:"destructive",duration:o.ERROR});return}i.value=!0;try{const r=await g.updateTeam(f.value.id,{name:T.value,description:I.value});if(S(r)){n({title:"Error",description:r.data.error,variant:"destructive",duration:o.ERROR});return}n({title:"Success",description:"Team updated successfully",duration:o.SUCCESS}),await re()}catch(r){console.error("Error updating team:",r),n({title:"Error",description:"Failed to update team. Please try again.",variant:"destructive",duration:o.ERROR})}finally{i.value=!1}}},ke=async()=>{if(!(!f.value||!U.value))try{i.value=!0;const r=await g.addTeamMember(f.value.id,{user_id:Number(U.value),role:P.value});if(S(r)){n({title:"Error",description:r.data.error,variant:"destructive",duration:o.ERROR});return}n({title:"Success",description:"Member added successfully",duration:o.SUCCESS}),U.value="",P.value="member",C.value=!1,await H()}catch(r){console.error("Error adding team member:",r),n({title:"Error",description:k(r),variant:"destructive",duration:o.ERROR})}finally{i.value=!1}},$e=async r=>{if(f.value)try{i.value=!0;const e=await g.removeTeamMember(f.value.id,Number(r));if(S(e)){n({title:"Error",description:e.data.error,variant:"destructive",duration:o.ERROR});return}n({title:"Success",description:"Member removed successfully",duration:o.SUCCESS}),await H()}catch(e){console.error("Error removing team member:",e),n({title:"Error",description:k(e),variant:"destructive",duration:o.ERROR})}finally{i.value=!1}},Te=async()=>{if(!(!f.value||!A.value))try{i.value=!0;const r=await g.addTeamSource(f.value.id,Number(A.value));if(S(r)){n({title:"Error",description:r.data.error,variant:"destructive",duration:o.ERROR});return}n({title:"Success",description:"Source added successfully",duration:o.SUCCESS}),A.value="",M.value=!1,await K()}catch(r){console.error("Error adding team source:",r),n({title:"Error",description:k(r),variant:"destructive",duration:o.ERROR})}finally{i.value=!1}},Ce=async r=>{if(f.value)try{i.value=!0;const e=await g.removeTeamSource(f.value.id,Number(r));if(S(e)){n({title:"Error",description:e.data.error,variant:"destructive",duration:o.ERROR});return}n({title:"Success",description:"Source removed successfully",duration:o.SUCCESS}),await K()}catch(e){console.error("Error removing team source:",e),n({title:"Error",description:k(e),variant:"destructive",duration:o.ERROR})}finally{i.value=!1}};return Ve(async()=>{await Promise.all([re(),x.loadUsers(),K()])}),(r,e)=>(d(),b("div",Ge,[p.value?(d(),b("div",Je," Loading team... ")):f.value?(d(),b(V,{key:2},[m("div",null,[m("h1",Xe,_(f.value.name),1),e[9]||(e[9]=m("p",{class:"text-muted-foreground mt-2"}," Manage team settings and members ",-1))]),t(a(je),{defaultValue:"members",class:"space-y-6"},{default:l(()=>[t(a(Be),null,{default:l(()=>[t(a(Y),{value:"members"},{default:l(()=>e[10]||(e[10]=[s("Members")])),_:1}),t(a(Y),{value:"sources"},{default:l(()=>e[11]||(e[11]=[s("Sources")])),_:1}),t(a(Y),{value:"settings"},{default:l(()=>e[12]||(e[12]=[s("Settings")])),_:1})]),_:1}),t(a(Z),{value:"members"},{default:l(()=>[t(a(W),null,{default:l(()=>[t(a(G),null,{default:l(()=>[m("div",Ye,[m("div",null,[t(a(Q),null,{default:l(()=>e[13]||(e[13]=[s("Team Members")])),_:1}),t(a(X),null,{default:l(()=>e[14]||(e[14]=[s(" Manage team members and their roles ")])),_:1})]),t(a(me),{open:C.value,"onUpdate:open":e[3]||(e[3]=u=>C.value=u)},{default:l(()=>[t(a(ye),{asChild:""},{default:l(()=>[t(a(y),null,{default:l(()=>[t(a(Ke),{class:"mr-2 h-4 w-4"}),e[15]||(e[15]=s(" Add Member "))]),_:1})]),_:1}),t(a(fe),null,{default:l(()=>[t(a(ve),null,{default:l(()=>[t(a(ce),null,{default:l(()=>e[16]||(e[16]=[s("Add Team Member")])),_:1}),t(a(pe),null,{default:l(()=>e[17]||(e[17]=[s(" Add a new member to the team ")])),_:1})]),_:1}),m("div",Ze,[m("div",he,[t(a(O),null,{default:l(()=>e[18]||(e[18]=[s("User")])),_:1}),t(a(h),{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=u=>U.value=u)},{default:l(()=>[t(a(ee),null,{default:l(()=>[t(a(ae),{placeholder:"Select a user"})]),_:1}),t(a(te),null,{default:l(()=>[(d(!0),b(V,null,j(ge.value,u=>(d(),c(a(F),{key:u.id,value:u.id},{default:l(()=>[s(_(u.email)+" ("+_(u.full_name)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),m("div",ea,[t(a(O),null,{default:l(()=>e[19]||(e[19]=[s("Role")])),_:1}),t(a(h),{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=u=>P.value=u)},{default:l(()=>[t(a(ee),null,{default:l(()=>[t(a(ae),{placeholder:"Select a role"})]),_:1}),t(a(te),null,{default:l(()=>[t(a(F),{value:"member"},{default:l(()=>e[20]||(e[20]=[s("Member")])),_:1}),t(a(F),{value:"admin"},{default:l(()=>e[21]||(e[21]=[s("Admin")])),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t(a(_e),null,{default:l(()=>[t(a(y),{variant:"outline",onClick:e[2]||(e[2]=u=>C.value=!1)},{default:l(()=>e[22]||(e[22]=[s(" Cancel ")])),_:1}),t(a(y),{disabled:i.value,onClick:ke},{default:l(()=>[i.value?(d(),c(a(N),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):(d(),c(a(Re),{key:1,class:"mr-2 h-4 w-4"})),e[23]||(e[23]=s(" Add Member "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1}),t(a(J),null,{default:l(()=>[t(a(ie),null,{default:l(()=>[t(a(oe),null,{default:l(()=>[t(a(B),null,{default:l(()=>[t(a(E),null,{default:l(()=>e[24]||(e[24]=[s("Email")])),_:1}),t(a(E),null,{default:l(()=>e[25]||(e[25]=[s("Role")])),_:1}),t(a(E),null,{default:l(()=>e[26]||(e[26]=[s("Added")])),_:1}),t(a(E),{class:"text-right"},{default:l(()=>e[27]||(e[27]=[s("Actions")])),_:1})]),_:1})]),_:1}),t(a(de),null,{default:l(()=>[(d(!0),b(V,null,j($.value,u=>(d(),c(a(B),{key:u.user_id},{default:l(()=>[t(a(w),null,{default:l(()=>{var L,se;return[m("div",aa,[m("span",null,_((L=le(u.user_id))==null?void 0:L.email),1),m("span",ta,_((se=le(u.user_id))==null?void 0:se.full_name),1)])]}),_:2},1024),t(a(w),{class:"capitalize"},{default:l(()=>[s(_(u.role),1)]),_:2},1024),t(a(w),null,{default:l(()=>[s(_(a(He)(new Date(u.created_at),"PPp")),1)]),_:2},1024),t(a(w),{class:"text-right"},{default:l(()=>[t(a(y),{variant:"destructive",size:"icon",disabled:i.value,onClick:L=>$e(u.user_id)},{default:l(()=>[i.value?(d(),c(a(N),{key:0,class:"h-4 w-4 animate-spin"})):(d(),c(a(be),{key:1,class:"h-4 w-4"}))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(a(Z),{value:"sources"},{default:l(()=>[t(a(W),null,{default:l(()=>[t(a(G),null,{default:l(()=>[m("div",la,[m("div",null,[t(a(Q),null,{default:l(()=>e[28]||(e[28]=[s("Team Sources")])),_:1}),t(a(X),null,{default:l(()=>e[29]||(e[29]=[s(" Manage data sources for this team ")])),_:1})]),t(a(me),{open:M.value,"onUpdate:open":e[6]||(e[6]=u=>M.value=u)},{default:l(()=>[t(a(ye),{asChild:""},{default:l(()=>[t(a(y),null,{default:l(()=>[t(a(Ne),{class:"mr-2 h-4 w-4"}),e[30]||(e[30]=s(" Add Source "))]),_:1})]),_:1}),t(a(fe),null,{default:l(()=>[t(a(ve),null,{default:l(()=>[t(a(ce),null,{default:l(()=>e[31]||(e[31]=[s("Add Data Source")])),_:1}),t(a(pe),null,{default:l(()=>e[32]||(e[32]=[s(" Add a data source to the team ")])),_:1})]),_:1}),m("div",ra,[m("div",sa,[t(a(O),null,{default:l(()=>e[33]||(e[33]=[s("Source")])),_:1}),t(a(h),{modelValue:A.value,"onUpdate:modelValue":e[4]||(e[4]=u=>A.value=u)},{default:l(()=>[t(a(ee),null,{default:l(()=>[t(a(ae),{placeholder:"Select a source"})]),_:1}),t(a(te),null,{default:l(()=>[(d(!0),b(V,null,j(Ee.value,u=>(d(),c(a(F),{key:u.id,value:String(u.id)},{default:l(()=>[s(_(a(Se)(u)),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),t(a(_e),null,{default:l(()=>[t(a(y),{variant:"outline",onClick:e[5]||(e[5]=u=>M.value=!1)},{default:l(()=>e[34]||(e[34]=[s(" Cancel ")])),_:1}),t(a(y),{disabled:i.value,onClick:Te},{default:l(()=>[i.value?(d(),c(a(N),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):(d(),c(a(Re),{key:1,class:"mr-2 h-4 w-4"})),e[35]||(e[35]=s(" Add Source "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1}),t(a(J),null,{default:l(()=>[t(a(ie),null,{default:l(()=>[t(a(oe),null,{default:l(()=>[t(a(B),null,{default:l(()=>[t(a(E),null,{default:l(()=>e[36]||(e[36]=[s("Source")])),_:1}),t(a(E),null,{default:l(()=>e[37]||(e[37]=[s("Description")])),_:1}),t(a(E),null,{default:l(()=>e[38]||(e[38]=[s("Added")])),_:1}),t(a(E),{class:"text-right"},{default:l(()=>e[39]||(e[39]=[s("Actions")])),_:1})]),_:1})]),_:1}),t(a(de),null,{default:l(()=>[(d(!0),b(V,null,j(z.value,u=>(d(),c(a(B),{key:u.id},{default:l(()=>[t(a(w),null,{default:l(()=>[s(_(a(Se)(u)),1)]),_:2},1024),t(a(w),null,{default:l(()=>[s(_(u.description),1)]),_:2},1024),t(a(w),null,{default:l(()=>[s(_(a(ze)(u.created_at)),1)]),_:2},1024),t(a(w),{class:"text-right"},{default:l(()=>[t(a(y),{variant:"destructive",size:"icon",disabled:i.value,onClick:L=>Ce(u.id)},{default:l(()=>[i.value?(d(),c(a(N),{key:0,class:"h-4 w-4 animate-spin"})):(d(),c(a(be),{key:1,class:"h-4 w-4"}))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(a(Z),{value:"settings"},{default:l(()=>[t(a(W),null,{default:l(()=>[t(a(G),null,{default:l(()=>[t(a(Q),null,{default:l(()=>e[40]||(e[40]=[s("Team Settings")])),_:1}),t(a(X),null,{default:l(()=>e[41]||(e[41]=[s(" Update team information ")])),_:1})]),_:1}),t(a(J),null,{default:l(()=>[m("form",{onSubmit:Ie(we,["prevent"]),class:"space-y-6"},[m("div",ua,[m("div",na,[t(a(O),{for:"name"},{default:l(()=>e[42]||(e[42]=[s("Team Name")])),_:1}),t(a(Pe),{id:"name",modelValue:T.value,"onUpdate:modelValue":e[7]||(e[7]=u=>T.value=u),required:""},null,8,["modelValue"])]),m("div",ia,[t(a(O),{for:"description"},{default:l(()=>e[43]||(e[43]=[s("Description")])),_:1}),t(a(Le),{id:"description",modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=u=>I.value=u),placeholder:"Team description",rows:"3"},null,8,["modelValue"])])]),m("div",oa,[t(a(y),{type:"submit",disabled:i.value},{default:l(()=>[i.value?(d(),c(a(N),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):De("",!0),e[44]||(e[44]=s(" Save Changes "))]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})]),_:1})]),_:1})],64)):(d(),b("div",Qe," Team not found "))]))}});export{Ma as default};
