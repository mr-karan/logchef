import{c as z,d as J,ae as W,g as k,R as $,ai as H,W as K,a as f,m as l,k as E,l as X,i as s,w as r,u as t,ap as Y,_ as V,F as R,B as b,j as u,t as m,n as Z,af as G,aj as ee,ak as te,ao as se,an as T,o as d}from"./index-DhD1Jy6j.js";import{_ as ae,a as re,b as D,c as g,d as ie,e as S}from"./TableHeader.vue_vue_type_script_setup_true_lang-ag95AMYa.js";import{_ as ne,a as oe,b as le,c as ue,d as de,e as ce}from"./SelectValue.vue_vue_type_script_setup_true_lang-aDyRn7dA.js";import{u as fe,_ as me,C as pe,f as ve}from"./SaveQueryModal.vue_vue_type_script_setup_true_lang-DGcrLFXq.js";import{T as _,g as C}from"./types-ByjhqKv5.js";import{u as _e}from"./sources-BtojJ080.js";import{f as ye}from"./format-D5zbNZR6.js";import{_ as xe,a as ge,b as Se}from"./CollapsibleTrigger.vue_vue_type_script_setup_true_lang-9BwK9zoW.js";import{T as we}from"./trash-2-CmwYiK2P.js";import"./monaco-editor-2qzqsP3x.js";import"./format-HUUZeily.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DfBq9sy2.js";import"./Label.vue_vue_type_script_setup_true_lang-CYXJfKeA.js";import"./Textarea.vue_vue_type_script_setup_true_lang-D0jxCyCO.js";import"./base-AlOswPYA.js";import"./teams-B0mpmRSw.js";/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=z("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=z("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Ce={class:"container py-6 space-y-6"},he={class:"flex items-center space-x-4"},Qe={key:0,class:"flex justify-center items-center py-8"},Ee={key:1,class:"flex flex-col justify-center items-center py-12 space-y-4"},Re={key:2,class:"flex flex-col justify-center items-center py-12 space-y-4"},be={key:3,class:"space-y-6"},Te={class:"flex items-center"},Ne={class:"text-lg font-medium"},Ue={class:"ml-2 text-sm text-muted-foreground"},je=["onClick","href"],Ye=J({__name:"SavedQueriesView",setup(Le){const B=Y(),{toast:p}=W(),h=fe(),c=_e(),N=k(()=>c.isLoading||h.isLoading),y=$(!1),v=$(null),n=$(""),x=$({}),U=k(()=>{const a=c.sourceQueriesMap[n.value]||[];return a.length===1?{[a[0].team_id]:!0}:x.value});H(async()=>{try{await c.loadUserSources(),c.deduplicatedSources.length>0&&(n.value=String(c.deduplicatedSources[0].id),await w(n.value))}catch(a){p({title:"Error",description:C(a),variant:"destructive",duration:_.ERROR})}}),K(()=>n.value,async a=>{a&&await w(a)});async function w(a){try{await c.loadSourceQueries(a)}catch(e){p({title:"Error",description:C(e),variant:"destructive",duration:_.ERROR})}}function I(a){const e=String(a);x.value={...x.value,[e]:!x.value[e]}}function j(a){try{return ve(new Date(a),new Date,{addSuffix:!0})}catch{return a}}function L(a){try{return JSON.parse(a.query_content),`/logs/explore?query_id=${a.id}`}catch(e){return console.error("Error generating query URL:",e),`/logs/explore?query_id=${a.id}`}}function M(a){const e=L(a);window.open(e,"_blank")}function A(a){v.value=a,y.value=!0}async function P(a){if(window.confirm(`Are you sure you want to delete "${a.name}"? This action cannot be undone.`))try{await h.deleteQuery(a.team_id,a.id),n.value&&await w(n.value),p({title:"Success",description:"Query deleted successfully",duration:_.SUCCESS})}catch(e){p({title:"Error",description:C(e),variant:"destructive",duration:_.ERROR})}}async function F(a){try{v.value&&(await h.updateQuery(a.team_id,v.value.id,{name:a.name,description:a.description}),n.value&&await w(n.value),p({title:"Success",description:"Query updated successfully",duration:_.SUCCESS})),y.value=!1,v.value=null}catch(e){p({title:"Error",description:C(e),variant:"destructive",duration:_.ERROR})}}const O=k(()=>n.value?c.sourceQueriesMap[n.value]||[]:[]),q=k(()=>O.value.some(a=>a.queries.length>0));return(a,e)=>(d(),f("div",Ce,[e[17]||(e[17]=l("div",{class:"flex justify-between items-center"},[l("h1",{class:"text-2xl font-bold tracking-tight"},"Saved Queries")],-1)),l("div",he,[e[3]||(e[3]=l("span",{class:"font-medium"},"Source:",-1)),s(t(ne),{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=i=>n.value=i),disabled:N.value||!t(c).deduplicatedSources.length,class:"w-[300px]"},{default:r(()=>[s(t(oe),null,{default:r(()=>[s(t(le),{placeholder:"Select a source"})]),_:1}),s(t(ue),null,{default:r(()=>[(d(!0),f(R,null,b(t(c).deduplicatedSources,i=>(d(),E(t(de),{key:i.id,value:String(i.id)},{default:r(()=>[u(m(t(ye)(i)),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])]),N.value?(d(),f("div",Qe,e[4]||(e[4]=[l("p",{class:"text-muted-foreground"},"Loading saved queries...",-1)]))):n.value?q.value?(d(),f("div",be,[(d(!0),f(R,null,b(O.value,i=>(d(),f("div",{key:i.team_id,class:"border rounded-md shadow-sm"},[s(t(Se),{open:U.value[i.team_id],"onUpdate:open":o=>x.value[i.team_id]=o},{default:r(()=>[s(t(xe),{class:"flex justify-between items-center w-full p-4 cursor-pointer hover:bg-muted/50",onClick:o=>I(i.team_id)},{default:r(()=>[l("div",Te,[s(t(pe),{class:Z(["h-5 w-5 mr-2 transition-transform duration-200",{"rotate-90":U.value[i.team_id]}])},null,8,["class"]),l("h3",Ne,m(i.team_name),1),l("div",Ue," ("+m(i.queries.length)+" "+m(i.queries.length===1?"query":"queries")+") ",1)])]),_:2},1032,["onClick"]),s(t(ge),null,{default:r(()=>[s(t(ae),null,{default:r(()=>[s(t(re),null,{default:r(()=>[s(t(D),null,{default:r(()=>[s(t(g),{class:"w-[300px]"},{default:r(()=>e[9]||(e[9]=[u("Name")])),_:1}),s(t(g),null,{default:r(()=>e[10]||(e[10]=[u("Description")])),_:1}),s(t(g),{class:"w-[180px]"},{default:r(()=>e[11]||(e[11]=[u("Created")])),_:1}),s(t(g),{class:"w-[180px]"},{default:r(()=>e[12]||(e[12]=[u("Updated")])),_:1}),s(t(g),{class:"w-[100px] text-right"},{default:r(()=>e[13]||(e[13]=[u("Actions")])),_:1})]),_:1})]),_:1}),s(t(ie),null,{default:r(()=>[(d(!0),f(R,null,b(i.queries,o=>(d(),E(t(D),{key:o.id},{default:r(()=>[s(t(S),{class:"font-medium"},{default:r(()=>[l("a",{onClick:G(Q=>M(o),["prevent"]),href:L(o),class:"text-primary hover:underline cursor-pointer"},m(o.name),9,je)]),_:2},1024),s(t(S),null,{default:r(()=>[u(m(o.description||"No description"),1)]),_:2},1024),s(t(S),null,{default:r(()=>[u(m(j(o.created_at)),1)]),_:2},1024),s(t(S),null,{default:r(()=>[u(m(j(o.updated_at)),1)]),_:2},1024),s(t(S),{class:"text-right"},{default:r(()=>[s(t(ee),null,{default:r(()=>[s(t(te),{asChild:""},{default:r(()=>[s(t(V),{variant:"ghost",size:"icon"},{default:r(()=>[s(t(ce),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(se),{align:"end"},{default:r(()=>[s(t(T),{onClick:Q=>M(o)},{default:r(()=>[s(t(ke),{class:"mr-2 h-4 w-4"}),e[14]||(e[14]=u(" Open "))]),_:2},1032,["onClick"]),s(t(T),{onClick:Q=>A(o)},{default:r(()=>[s(t($e),{class:"mr-2 h-4 w-4"}),e[15]||(e[15]=u(" Edit "))]),_:2},1032,["onClick"]),s(t(T),{onClick:Q=>P(o),class:"text-destructive"},{default:r(()=>[s(t(we),{class:"mr-2 h-4 w-4"}),e[16]||(e[16]=u(" Delete "))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["open","onUpdate:open"])]))),128))])):(d(),f("div",Re,[e[7]||(e[7]=l("p",{class:"text-xl text-muted-foreground"},"No saved queries found",-1)),e[8]||(e[8]=l("p",{class:"text-muted-foreground"}," Create a query in the Explorer and save it to access it here. ",-1)),s(t(V),{onClick:e[1]||(e[1]=i=>t(B).push("/logs/explore?source="+n.value))},{default:r(()=>e[6]||(e[6]=[u("Go to Explorer")])),_:1})])):(d(),f("div",Ee,e[5]||(e[5]=[l("p",{class:"text-xl text-muted-foreground"},"No source selected",-1),l("p",{class:"text-muted-foreground"}," Please select a source to view its saved queries. ",-1)]))),y.value&&v.value?(d(),E(me,{key:4,"is-open":y.value,"initial-data":v.value,"is-edit-mode":!0,onClose:e[2]||(e[2]=i=>y.value=!1),onSave:F},null,8,["is-open","initial-data"])):X("",!0)]))}});export{Ye as default};
