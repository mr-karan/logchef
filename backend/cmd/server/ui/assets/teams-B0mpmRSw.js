import{as as n,at as S,R as m,ae as $,g as b}from"./index-DhD1Jy6j.js";import{i as c,T as i}from"./types-ByjhqKv5.js";const d={async listTeams(){return(await n.get("/teams")).data},async getTeam(e){return(await n.get(`/teams/${e}`)).data},async createTeam(e){return(await n.post("/teams",e)).data},async updateTeam(e,a){return(await n.put(`/teams/${e}`,a)).data},async deleteTeam(e){return(await n.delete(`/teams/${e}`)).data},async listTeamMembers(e){return(await n.get(`/teams/${e}/members`)).data},async addTeamMember(e,a){return(await n.post(`/teams/${e}/members`,a)).data},async removeTeamMember(e,a){return(await n.delete(`/teams/${e}/members/${a}`)).data},async listTeamSources(e){return(await n.get(`/teams/${e}/sources`)).data},async addTeamSource(e,a){return(await n.post(`/teams/${e}/sources`,{source_id:a})).data},async removeTeamSource(e,a){return(await n.delete(`/teams/${e}/sources/${a}`)).data}},C=S("teams",()=>{const e=m([]),a=m(!1),s=m(null),o=m(null),{toast:u}=$(),y=b(()=>o.value?e.value.find(t=>t.id===o.value):null);async function v(){if(!a.value)try{a.value=!0,s.value=null;const t=await d.listTeams();if(c(t)){s.value=t.data.error,u({title:"Error",description:t.data.error,variant:"destructive",duration:i.ERROR}),e.value=[];return}const r=t.data||[],l=await Promise.all(r.map(async T=>{const p=await d.listTeamMembers(T.id),g=c(p)||!p.data?0:p.data.length;return{...T,memberCount:g}}));e.value=l,!o.value&&e.value.length>0&&f(e.value[0].id)}catch(t){s.value="Failed to load teams",console.error("Error loading teams:",t),u({title:"Error",description:"Failed to load teams",variant:"destructive",duration:i.ERROR}),e.value=[]}finally{a.value=!1}}function f(t){o.value=t}async function R(t){try{const r=await d.createTeam(t);return c(r)?(u({title:"Error",description:r.data.error,variant:"destructive",duration:i.ERROR}),!1):(u({title:"Success",description:"Team created successfully",duration:i.SUCCESS}),await v(),!0)}catch(r){return console.error("Error creating team:",r),u({title:"Error",description:"Failed to create team",variant:"destructive",duration:i.ERROR}),!1}}async function w(t){if(a.value)return!1;try{a.value=!0,s.value=null;const r=await d.deleteTeam(t);return c(r)?(s.value=r.data.error,u({title:"Error",description:r.data.error,variant:"destructive",duration:i.ERROR}),!1):(e.value=e.value.filter(l=>l.id!==t),o.value===t&&(o.value=e.value.length>0?e.value[0].id:null),u({title:"Success",description:"Team deleted successfully",duration:i.SUCCESS}),!0)}catch(r){return console.error("Error deleting team:",r),!1}finally{a.value=!1}}async function E(t){if(a.value)return[];try{a.value=!0,s.value=null;const r=await d.listTeamSources(t);return c(r)?(s.value=r.data.error,[]):(r.data||[]).map(l=>l.id)}catch(r){return console.error("Error getting team sources:",r),[]}finally{a.value=!1}}return{teams:e,isLoading:a,error:s,currentTeamId:o,currentTeam:y,loadTeams:v,createTeam:R,deleteTeam:w,setCurrentTeam:f,getTeamSourceIds:E}});export{d as t,C as u};
